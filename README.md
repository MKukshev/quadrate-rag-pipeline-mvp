
# AI Assistant MVP (Offline)

–õ–æ–∫–∞–ª—å–Ω—ã–π RAG: Ingestion ‚Üí Index (Qdrant + BM25) ‚Üí Hybrid Search ‚Üí RAG —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—É—é LLM (Ollama/–¥—Ä.).

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (Ollama)

```bash
make up           # qdrant + ollama + backend
make wait         # –¥–æ–∂–¥–∞—Ç—å—Å—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ backend (health)
make pull-model   # —Å–∫–∞—á–∞–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å (MODEL=llama3.1:8b –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
make ingest       # –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ ./docs (SPACE=space_demo)
make ask          # —Ç–µ—Å—Ç–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å –∫ RAG
make health       # –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ (backend/embeddings/llm/qdrant)
```

### üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ GPU —Å–µ—Ä–≤–µ—Ä–µ (vLLM)

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/your-org/ai-assistant-mvp.git
cd ai-assistant-mvp

# 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å (–¥–æ–±–∞–≤–∏—Ç—å HF —Ç–æ–∫–µ–Ω)
cp .env.vllm .env
nano .env  # HUGGING_FACE_HUB_TOKEN=hf_xxxxx

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å vLLM —Å—Ç–µ–∫
make up-vllm

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
curl http://localhost:8000/health
```

üìö **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é:**
- [GPU_DEPLOYMENT_QUICKSTART.md](GPU_DEPLOYMENT_QUICKSTART.md) - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- [GPU_BACKEND_UPDATE.md](GPU_BACKEND_UPDATE.md) - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ GPU –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- [docs/GPU_DEPLOYMENT_GUIDE.md](docs/GPU_DEPLOYMENT_GUIDE.md) - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- [BLACKWELL_QUICKSTART.md](BLACKWELL_QUICKSTART.md) - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è RTX 6000 Blackwell

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- LLM: 150-400 tokens/sec vs 40-60 –Ω–∞ Ollama ‚ú®
- Backend: Embeddings 20x –±—ã—Å—Ç—Ä–µ–µ –Ω–∞ GPU (5ms vs 100ms)
- Backend: Reranking 25x –±—ã—Å—Ç—Ä–µ–µ –Ω–∞ GPU (2ms vs 50ms)

–û—Ç–∫—Ä–æ–π—Ç–µ Swagger: http://localhost:8000/docs

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞
- `backend/` ‚Äî FastAPI –∏ —Å–µ—Ä–≤–∏—Å—ã (–ø–∞—Ä—Å–∏–Ω–≥, —á–∞–Ω–∫, —ç–º–±–µ–¥–¥–∏–Ω–≥–∏, Qdrant, BM25, RRF, RAG)
- `cli/` ‚Äî –ø–∞–∫–µ—Ç–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞
- `docs/` ‚Äî –ø—Ä–∏–º–µ—Ä—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –ø–æ–¥–ø–∞–ø–∫–∏‚Äë–∫–∞—Ç–µ–≥–æ—Ä–∏–∏)

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
- –í—Å—ë –æ—Ñ–ª–∞–π–Ω. –ë–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö API.
- –≠–º–±–µ–¥–¥–∏–Ω–≥–∏: Sentence-Transformers (`all-MiniLM-L6-v2`).
- –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫: Qdrant (HNSW, —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ `space_id` –∏ `doc_type`).
- –ö–ª—é—á–µ–≤–æ–π –ø–æ–∏—Å–∫: Whoosh (BM25F) —Å –ø–æ–ª–µ–º `doc_type`.
- LLM Ollama: –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (`LLM_MODEL`, `LLM_TIMEOUT`, `LLM_MAX_TOKENS`, `LLM_STREAM_ENABLED`) –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è / `.env`.

## –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏: `email_correspondence`, `messenger_correspondence`, `presentations`, `protocols`, `technical_docs`, `work_plans`, `unstructured`.
- –õ—É—á—à–µ —Å–∫–ª–∞–¥—ã–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ –ø–æ–¥–ø–∞–ø–∫–∞–º `./docs/<category>/...`. –î–ª—è —Ñ–∞–π–ª–æ–≤ –≤ –∫–æ—Ä–Ω–µ `./docs` —Å—Ä–∞–±–æ—Ç–∞–µ—Ç —ç–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (–∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ + MiniLM + –ª–æ–≥—Ä–µ–≥—Ä–µ—Å—Å–∏—è, –µ—Å–ª–∏ –º–æ–¥–µ–ª—å –æ–±—É—á–µ–Ω–∞).
- CLI (`make ingest` ‚Üí `python -m cli.index_cli`) –∏ API `/ingest` —Å–æ—Ö—Ä–∞–Ω—è—é—Ç `doc_type` –≤ Qdrant/Whoosh. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã `/search` –∏ `/ask` —Å–æ–¥–µ—Ä–∂–∞—Ç `doc_type` –≤ payload/source.
- –£–∫–∞–∂–∏—Ç–µ `doc_type` —è–≤–Ω–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ (`multipart/form-data` –ø–æ–ª–µ `doc_type`). –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ ‚Äî –≤—ã–∑–æ–≤–µ—Ç—Å—è `services.categories.guess_doc_type`.
- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `DOC_TYPE_MODEL_PATH` (—Å–º. `.env.example`) —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ pickle —Å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º (–ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è –ø–æ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º MiniLM). –ï—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∞–≤–∏–ª–æ‚Äë–±–∞–∑–∞.
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ `CONTEXT_MAX_CHUNKS` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 6) –∏ `CHUNK_TOKENS` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 400) ‚Äî –º–æ–∂–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ `.env`.
- MMR –≤–∫–ª—é—á—ë–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (`MMR_ENABLED`), —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ `MMR_LAMBDA` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.7) –∏ `MMR_CANDIDATE_MULTIPLIER` (—Å–∫–æ–ª—å–∫–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –±—Ä–∞—Ç—å –ø–µ—Ä–µ–¥ –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏–µ–π).
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ (`CACHE_ENABLED`, `CACHE_TTL_SECONDS`, `CACHE_MAX_ITEMS`) —Å–Ω–∏–∂–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏.
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–¥–∏–Ω —á–∞–Ω–∫ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç (`ONE_CHUNK_PER_DOC=true`); –ø—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –¥—Ä—É–≥–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ |
|------------|--------------|----------|--------------------|
| `LLM_MODE` | `ollama` | –ü—Ä–æ–≤–∞–π–¥–µ—Ä LLM (`ollama`, `none`, –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ `vllm`/`tgi`). | –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ `vllm/tgi` —É—Å–∫–æ—Ä—è–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é (–Ω—É–∂–µ–Ω GPU); `none` –≤—ã–∫–ª—é—á–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã. –î–∏–∞–ø–∞–∑–æ–Ω: `ollama` / `vllm` / `tgi` / `none`. |
| `LLM_MODEL` | `llama3.1:8b` | –ò–º—è –º–æ–¥–µ–ª–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤. | –ë–æ–ª–µ–µ –∫—Ä—É–ø–Ω–∞—è –º–æ–¥–µ–ª—å = –∫–∞—á–µ—Å—Ç–≤–æ‚Üë, –∑–∞–¥–µ—Ä–∂–∫–∞/–ø–∞–º—è—Ç—å‚Üë; –±–æ–ª–µ–µ –ª—ë–≥–∫–∞—è = –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ —Ç–æ—á–Ω–æ—Å—Ç—å‚Üì. –î–∏–∞–ø–∞–∑–æ–Ω: –ª—é–±–∞—è –º–æ–¥–µ–ª—å, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–∞—è –≤—ã–±—Ä–∞–Ω–Ω—ã–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º. |
| `LLM_TIMEOUT` | `240` | –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫ LLM (—Å–µ–∫). | –£–≤–µ–ª–∏—á–∏—Ç—å ‚Äî –º–µ–Ω—å—à–µ —Ç–∞–π–º–∞—É—Ç–æ–≤, –Ω–æ –¥–æ–ª—å—à–µ –∂–¥–∞—Ç—å; —É–º–µ–Ω—å—à–∏—Ç—å ‚Äî –±—ã—Å—Ç—Ä–µ–µ —Ñ–µ–π–ª, –≤–æ–∑–º–æ–∂–Ω—ã –ª–æ–∂–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã. –†–∞–∑—É–º–Ω–æ: 60‚Äì600 —Å. |
| `LLM_MAX_TOKENS` | `256` | –ú–∞–∫—Å–∏–º—É–º –Ω–æ–≤—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ –≤ –æ—Ç–≤–µ—Ç–µ (–æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –¥–ª–∏–Ω—É). | ‚Üë ‚Äî –ø–æ–ª–Ω–æ—Ç–∞‚Üë, latency‚Üë; ‚Üì ‚Äî –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ —Ä–∏—Å–∫ —É—Å–µ—á—ë–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤. –†–∞–∑—É–º–Ω–æ: 64‚Äì512. |
| `LLM_STREAM_ENABLED` | `false` | –ï—Å–ª–∏ `true`, Ollama —à–ª—ë—Ç –ø–æ—Ç–æ–∫; backend —Å–æ–±–∏—Ä–∞–µ—Ç –µ–≥–æ –∫—É—Å–∫–∏. | –í–∫–ª. ‚Äî —Å–æ–∫—Ä–∞—â–∞–µ—Ç TTFB; –≤—ã–∫–ª. ‚Äî –ø—Ä–æ—â–µ –æ–±—Ä–∞–±–æ—Ç–∫–∞, –Ω–æ –æ—Ç–≤–µ—Ç —Ü–µ–ª–∏–∫–æ–º. –í–∞—Ä–∏–∞–Ω—Ç—ã: `true`/`false`. |
| `QDRANT_URL` | `http://qdrant:6333` | –ê–¥—Ä–µ—Å Qdrant. | –õ–æ–∫–∞–ª—å–Ω—ã–π/—É–¥–∞–ª—ë–Ω–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä; –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è. |
| `QDRANT_COLLECTION` | `docs` | –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏. | –ú–æ–∂–Ω–æ —Ä–∞–∑–¥–µ–ª—è—Ç—å —Å—Ä–µ–¥—ã (prod/stage) –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏. |
| `QDRANT_HNSW_M` | `16` | –ü–∞—Ä–∞–º–µ—Ç—Ä `m` (—Ä–∞–∑–≤–µ—Ç–≤–ª—ë–Ω–Ω–æ—Å—Ç—å –≥—Ä–∞—Ñ–∞) –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏. | ‚Üë ‚Äî recall‚Üë, –ø–∞–º—è—Ç—å/–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è‚Üë; ‚Üì ‚Äî –ª–µ–≥—á–µ –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º. –†–∞–∑—É–º–Ω–æ: 12‚Äì32. |
| `QDRANT_HNSW_EF_CONSTRUCT` | `100` | `ef_construct` –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞ HNSW. | ‚Üë ‚Äî —Ç–æ—á–Ω–æ—Å—Ç—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏‚Üë, –Ω–æ –∑–∞–ø–∏—Å—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ; ‚Üì ‚Äî –Ω–∞–æ–±–æ—Ä–æ—Ç. –†–∞–∑—É–º–Ω–æ: 80‚Äì200. |
| `QDRANT_HNSW_EF_SEARCH` | `64` | `ef` –ø—Ä–∏ –ø–æ–∏—Å–∫–µ (–±–∞–ª–∞–Ω—Å —Ç–æ—á–Ω–æ—Å—Ç–∏/–ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏). | ‚Üë ‚Äî recall‚Üë, latency‚Üë; ‚Üì ‚Äî –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ —Ä–∏—Å–∫ –ø—Ä–æ–ø—É—Å–∫–æ–≤. –†–∞–∑—É–º–Ω–æ: 32‚Äì128. |
| `DOC_TYPE_MODEL_PATH` | `backend/models/doc_type_classifier.joblib` | –ü—É—Ç—å –∫ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É —Ç–∏–ø–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤. | –£–∫–∞–∑–∞—Ç—å —Å–≤–æ–π –ø—É—Ç—å ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –º–æ–¥–µ–ª—å; –ø—É—Å—Ç–æ ‚Äî —Ç–æ–ª—å–∫–æ —ç–≤—Ä–∏—Å—Ç–∏–∫–∏. –ó–Ω–∞—á–µ–Ω–∏–µ: –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –ø—É—Ç—å –∫ `.joblib`. |
| `AUTO_DOC_TYPES` | `true` | –ê–≤—Ç–æ–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ `doc_types` –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º –∑–∞–ø—Ä–æ—Å–∞. | –í–∫–ª. ‚Äî –º–µ–Ω—å—à–µ —à—É–º–∞, –Ω–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–ª–æ–≤–∞—Ä—è; –≤—ã–∫–ª. ‚Äî –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å —É –∫–ª–∏–µ–Ω—Ç–∞. –í–∞—Ä–∏–∞–Ω—Ç—ã: `true`/`false`. |
| `CHUNK_TOKENS` | `400` | –†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞ –ø—Ä–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ (—Å–ª–æ–≤–∞–º–∏). | ‚Üë ‚Äî –º–µ–Ω—å—à–µ —á–∞–Ω–∫–æ–≤, –Ω–æ —Ç—è–∂—ë–ª—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç; ‚Üì ‚Äî —Ç–æ—á–Ω–µ–µ, –Ω–æ –±–æ–ª—å—à–µ –∑–∞–ø–∏—Å–µ–π. –†–∞–∑—É–º–Ω–æ: 200‚Äì800. |
| `CHUNK_OVERLAP` | `50` | –ü–µ—Ä–µ—Ö–ª—ë—Å—Ç —á–∞–Ω–∫–æ–≤ (—Å–ª–æ–≤). | ‚Üë ‚Äî –º–µ–Ω—å—à–µ —Ä–∞–∑—Ä—ã–≤–æ–≤, –Ω–æ –±–æ–ª—å—à–µ –æ–±—ä—ë–º; ‚Üì ‚Äî –±—ã—Å—Ç—Ä–µ–µ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è, —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ —Å–≤—è–∑–æ–∫. –†–∞–∑—É–º–Ω–æ: 30‚Äì200. |
| `CONTEXT_MAX_CHUNKS` | `6` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ —á–∞–Ω–∫–æ–≤, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö –≤ LLM. | ‚Üë ‚Äî –±–æ–ª—å—à–µ —Ñ–∞–∫—Ç–æ–≤, latency‚Üë; ‚Üì ‚Äî –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ —Ä–∏—Å–∫ –ø—Ä–æ–ø—É—Å–∫–æ–≤. –†–∞–∑—É–º–Ω–æ: 4‚Äì10. |
| `ONE_CHUNK_PER_DOC` | `true` | –°–∏–ª—å–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ –æ–¥–Ω–æ–º—É —á–∞–Ω–∫—É –∫–∞–∂–¥–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Å –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π –¥–æ–≥—Ä—É–∑–∫–æ–π. | –í–∫–ª. ‚Äî –º–µ–Ω—å—à–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, —Ç–æ–∫–µ–Ω–æ–≤‚Üì; –≤—ã–∫–ª. ‚Äî –±–æ–ª—å—à–µ –¥–µ—Ç–∞–ª–µ–π –∏–∑ –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞. –í–∞—Ä–∏–∞–Ω—Ç—ã: `true`/`false`. |
| `CONTEXT_SNIPPET_MAX_CHARS` | `600` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Å–∂–∞—Ç–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º–æ–≥–æ –≤ –ø—Ä–æ–º–ø—Ç. | ‚Üë ‚Äî –∫–æ–Ω—Ç–µ–∫—Å—Ç –±–æ–≥–∞—á–µ, latency‚Üë; ‚Üì ‚Äî –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ —Ä–∏—Å–∫ —É—Å–µ—á–µ–Ω–∏–π. –†–∞–∑—É–º–Ω–æ: 400‚Äì1000. |
| `TOP_K_DEFAULT` | `6` | –ë–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `top_k` (–∞–¥–∞–ø—Ç–∏–≤–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è). | ‚Üë ‚Äî –±–æ–ª—å—à–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤, latency‚Üë; ‚Üì ‚Äî –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ –º–µ–Ω—å—à–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤. –†–∞–∑—É–º–Ω–æ: 4‚Äì8. |
| `TOP_K_MIN` | `4` | –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ `top_k` –¥–ª—è ‚Äú—É–∑–∫–∏—Ö‚Äù –∑–∞–ø—Ä–æ—Å–æ–≤. | ‚Üë ‚Äî –¥–∞–∂–µ —É–∑–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –±–µ—Ä—É—Ç –±–æ–ª—å—à–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞; ‚Üì ‚Äî –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ —Å–∂–∏–º–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç. –†–∞–∑—É–º–Ω–æ: 3‚Äì5. |
| `TOP_K_MAX` | `8` | –í–µ—Ä—Ö–Ω–∏–π –ø—Ä–µ–¥–µ–ª `top_k` –¥–ª—è ‚Äú—à–∏—Ä–æ–∫–∏—Ö‚Äù –∑–∞–ø—Ä–æ—Å–æ–≤. | ‚Üë ‚Äî –∑–∞–ø–∞—Å –¥–ª—è —à–∏—Ä–æ–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, latency‚Üë; ‚Üì ‚Äî –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ –º–µ–Ω—å—à–µ –ø–æ–∫—Ä—ã—Ç–∏—è. –†–∞–∑—É–º–Ω–æ: 6‚Äì10. |
| `MMR_ENABLED` | `true` | –í–∫–ª—é—á–∞–µ—Ç Maximal Marginal Relevance –ø–µ—Ä–µ–¥ RAG. | –í–∫–ª. ‚Äî —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ‚Üë; –≤—ã–∫–ª. ‚Äî –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ –±–æ–ª—å—à–µ –ø–æ–≤—Ç–æ—Ä–æ–≤. –í–∞—Ä–∏–∞–Ω—Ç—ã: `true`/`false`. |
| `MMR_LAMBDA` | `0.7` | –ë–∞–ª–∞–Ω—Å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å/–¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (0‚Äì1). | ‚Üí1 ‚Äî –±–ª–∏–∂–µ –∫ –∑–∞–ø—Ä–æ—Å—É; ‚Üí0 ‚Äî –±–æ–ª—å—à–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è. –î–∏–∞–ø–∞–∑–æ–Ω: 0.3‚Äì0.9. |
| `MMR_CANDIDATE_MULTIPLIER` | `3` | –í–æ —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Ä–∞—Å—à–∏—Ä—è—Ç—å –ø—É–ª –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –ø–µ—Ä–µ–¥ MMR. | ‚Üë ‚Äî –∫–∞—á–µ—Å—Ç–≤–æ‚Üë, latency‚Üë; ‚Üì ‚Äî –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ –º–µ–Ω—å—à–µ —ç—Ñ—Ñ–µ–∫—Ç MMR. –†–∞–∑—É–º–Ω–æ: 2‚Äì4. |
| `CACHE_ENABLED` | `true` | –í–∫–ª—é—á–∞–µ—Ç –∫—ç—à –¥–ª—è `/search` –∏ `/ask`. | –í–∫–ª. ‚Äî –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –±—ã—Å—Ç—Ä–µ–µ; –≤—ã–∫–ª. ‚Äî –≤—Å–µ–≥–¥–∞ —Å–≤–µ–∂–∏–µ –æ—Ç–≤–µ—Ç—ã. –í–∞—Ä–∏–∞–Ω—Ç—ã: `true`/`false`. |
| `CACHE_TTL_SECONDS` | `300` | TTL (—Å–µ–∫) –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∫—ç—à–∞. | ‚Üë ‚Äî –±–æ–ª—å—à–µ reuse, –Ω–æ —Ä–∏—Å–∫ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤; ‚Üì ‚Äî —á–∞—â–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è. –†–∞–∑—É–º–Ω–æ: 60‚Äì900. |
| `CACHE_MAX_ITEMS` | `256` | –ú–∞–∫—Å–∏–º—É–º —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –∫—ç—à–µ (LRU). | ‚Üë ‚Äî –≤—ã—à–µ hit rate, –ø–∞–º—è—Ç—å‚Üë; ‚Üì ‚Äî —ç–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏. –†–∞–∑—É–º–Ω–æ: 128‚Äì512. |
| `RERANK_ENABLED` | `false` | –í–∫–ª—é—á–∞–µ—Ç cross-encoder rerank. | –í–∫–ª. ‚Äî –∫–∞—á–µ—Å—Ç–≤–æ‚Üë, –∑–∞–¥–µ—Ä–∂–∫–∞‚Üë; –≤—ã–∫–ª. ‚Äî –±—ã—Å—Ç—Ä–µ–µ. –í–∞—Ä–∏–∞–Ω—Ç—ã: `true`/`false`. |
| `RERANK_MODEL` | `cross-encoder/ms-marco-MiniLM-L-6-v2` | HuggingFace –º–æ–¥–µ–ª—å –¥–ª—è rerank. | –ë–æ–ª–µ–µ —Ç—è–∂—ë–ª–∞—è –º–æ–¥–µ–ª—å = —Ç–æ—á–Ω–æ—Å—Ç—å‚Üë/—Ä–µ—Å—É—Ä—Å—ã‚Üë; –ª—ë–≥–∫–∞—è ‚Äî –Ω–∞–æ–±–æ—Ä–æ—Ç. |
| `RERANK_MAX_CANDIDATES` | `32` | –°–∫–æ–ª—å–∫–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å reranker. | ‚Üë ‚Äî –∫–∞—á–µ—Å—Ç–≤–æ‚Üë, latency‚Üë; ‚Üì ‚Äî –±—ã—Å—Ç—Ä–µ–µ. –†–∞–∑—É–º–Ω–æ: 16‚Äì64. |
| `RERANK_BATCH_SIZE` | `16` | –ë–∞—Ç—á –ø—Ä–∏ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–µ cross-encoder. | ‚Üë ‚Äî –ª—É—á—à–µ –¥–ª—è GPU, –ø–∞–º—è—Ç—å‚Üë; ‚Üì ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ –Ω–∞ CPU. –†–∞–∑—É–º–Ω–æ: 8‚Äì32. |
- –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º—ã —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏–Ω–¥–µ–∫—Å: `make ingest SPACE=<space>`.
- –î–ª—è –æ–±—É—á–µ–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞: `make train-doctypes` (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ backend-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –º–æ–¥–µ–ª—å –ø–æ –ø—É—Ç–∏ `/app/backend/models/doc_type_classifier.joblib`). –ú–æ–¥–µ–ª—å –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Ö–æ—Å—Ç (`./backend/models`), –ø–æ—ç—Ç–æ–º—É –ø–µ—Ä–µ–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –∑–∞–º–µ–Ω–∏—Ç—å `doc_type_classifier.joblib` –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å backend.

### –ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- `/search` –∏ `/ask` –ø—Ä–∏–Ω–∏–º–∞—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä/–ø–æ–ª–µ `doc_types` (—Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫). –ü—Ä–∏–º–µ—Ä: `GET /search?q=...&doc_types=email_correspondence&doc_types=protocols`.
- –ë–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è `doc_types` —Å–µ—Ä–≤–∏—Å –ø—ã—Ç–∞–µ—Ç—Å—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ —Ç–µ–∫—Å—Ç—É –∑–∞–ø—Ä–æ—Å–∞; –æ—Ç–∫–ª—é—á–∏—Ç—å –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ `AUTO_DOC_TYPES=false`.
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –≤ —Å–≤–æ–±–æ–¥–Ω–æ–π —Ñ–æ—Ä–º–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä ‚Äú–Ω–∞–π–¥–∏ –≤ email‚Äë–ø–µ—Ä–µ–ø–∏—Å–∫–µ‚Äù) –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞, —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è—è –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ —Å `doc_types`.

## Healthcheck
- –≠–Ω–¥–ø–æ–∏–Ω—Ç `GET http://localhost:8000/health` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ backend, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Qdrant, –∑–∞–≥—Ä—É–∑–∫—É —ç–º–±–µ–¥–¥–µ—Ä–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Ollama.
- Docker healthcheck –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è `backend` —Å–µ—Ä–≤–∏—Å–∞.
- –≠–Ω–¥–ø–æ–∏–Ω—Ç `GET http://localhost:8000/metrics` –≤—ã–¥–∞—ë—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (–ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, —Ç–æ–∫–µ–Ω—ã, cache hit rate).
- –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞: —Å–º. [`docs/pipeline_diagram.md`](docs/pipeline_diagram.md) (mermaid-–±–ª–æ–∫ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É `/search` –∏ `/ask`).

## –õ–∏—Ü–µ–Ω–∑–∏—è
MIT (–ø—Ä–∏–º–µ—Ä).
