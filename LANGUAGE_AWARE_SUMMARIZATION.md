# Language-Aware Summarization (–Ø–∑—ã–∫–æ–≤–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)

## üåç –ü—Ä–æ–±–ª–µ–º–∞

**–ë—ã–ª–æ:**
- –í—Ö–æ–¥–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º ‚Üí Summary –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º ‚ùå
- –ù–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è —è–∑—ã–∫–∞ –æ—Ç–≤–µ—Ç–∞

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
- –í—Ö–æ–¥–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º ‚Üí Summary –Ω–∞ —Ä—É—Å—Å–∫–æ–º ‚úÖ
- –í—Ö–æ–¥–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º ‚Üí Summary –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º ‚úÖ

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: 3-—É—Ä–æ–≤–Ω–µ–≤—ã–π –ø–æ–¥—Ö–æ–¥

### 1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞**

```python
# backend/services/language_detection.py

def detect_language(text: str) -> str:
    """
    –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —è–∑—ã–∫ —Ç–µ–∫—Å—Ç–∞
    
    Returns: 'ru', 'en', –∏–ª–∏ 'unknown'
    """
    # –ü–æ–¥—Å—á–µ—Ç –∫–∏—Ä–∏–ª–ª–∏—Ü—ã vs –ª–∞—Ç–∏–Ω–∏—Ü—ã
    cyrillic_count = len(re.findall(r'[–∞-—è—ë]', text.lower()))
    latin_count = len(re.findall(r'[a-z]', text.lower()))
    
    cyrillic_ratio = cyrillic_count / (cyrillic_count + latin_count)
    
    if cyrillic_ratio > 0.3:
        return 'ru'  # > 30% –∫–∏—Ä–∏–ª–ª–∏—Ü—ã
    elif latin_count > 20:
        return 'en'
    
    return 'unknown'
```

### 2. **–Ø–∑—ã–∫–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤ –ø—Ä–æ–º–ø—Ç–µ**

```python
def get_language_instruction(detected_lang: str) -> str:
    """–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è LLM –æ —è–∑—ã–∫–µ –æ—Ç–≤–µ—Ç–∞"""
    
    instructions = {
        'ru': "–í–ê–ñ–ù–û: –û—Ç–≤–µ—á–∞–π –Ω–∞ –†–£–°–°–ö–û–ú –Ø–ó–´–ö–ï. –í—Ö–æ–¥–Ω–æ–π —Ç–µ–∫—Å—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º - —Ç–≤–æ–π –æ—Ç–≤–µ—Ç —Ç–æ–∂–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º.",
        'en': "IMPORTANT: Respond in ENGLISH. The input text is in English - your response must also be in English.",
        'unknown': "Respond in the same language as the input text."
    }
    
    return instructions[detected_lang]
```

### 3. **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏**

```python
# –°—Ç–∞—Ä—ã–π –ø—Ä–æ–º–ø—Ç (–±–µ–∑ —è–∑—ã–∫–∞):
prompt = f"""Summarize the following text...

TEXT:
{text}

SUMMARY:"""

# –ù–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç (—Å —è–∑—ã–∫–æ–º):
detected_lang = detect_language(text)
lang_instruction = get_language_instruction(detected_lang)
lang_name = get_language_name(detected_lang)  # '–†—É—Å—Å–∫–∏–π' –∏–ª–∏ 'English'

prompt = f"""{lang_instruction}

Summarize the following text concisely in approximately {max_tokens} words or less.
Preserve key facts, numbers, dates, and important details.
Remember: USE THE SAME LANGUAGE as the input text!

TEXT (Language: {lang_name}):
{text}

SUMMARY (in {lang_name}):"""
```

---

## üéØ Best Practices –∏–∑ –∞–≥–µ–Ω—Ç—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º

### 1. **Explicit Language Instruction** (–Ø–≤–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è)

**OpenAI, Anthropic —Ä–µ–∫–æ–º–µ–Ω–¥—É—é—Ç:**
```
"Respond in the same language as the input"
"Answer in [detected_language]"
```

‚òùÔ∏è –†–∞–∑–º–µ—â–∞—Ç—å –í –ù–ê–ß–ê–õ–ï –ø—Ä–æ–º–ø—Ç–∞ (—Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ!)

### 2. **Language Markers** (–ú–∞—Ä–∫–µ—Ä—ã —è–∑—ã–∫–∞)

```
TEXT (Language: –†—É—Å—Å–∫–∏–π):
...

SUMMARY (in –†—É—Å—Å–∫–∏–π):
```

‚òùÔ∏è –Ø–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å –≤ –∫–∞–∫–æ–º –º–µ—Å—Ç–µ –∫–∞–∫–æ–π —è–∑—ã–∫

### 3. **Repetition** (–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏)

```
–í–ê–ñ–ù–û: –û—Ç–≤–µ—á–∞–π –Ω–∞ –†–£–°–°–ö–û–ú –Ø–ó–´–ö–ï...
...
Remember: USE THE SAME LANGUAGE as the input text!
...
SUMMARY (in –†—É—Å—Å–∫–∏–π):
```

‚òùÔ∏è –ü–æ–≤—Ç–æ—Ä–∏—Ç—å 2-3 —Ä–∞–∑–∞ –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö –ø—Ä–æ–º–ø—Ç–∞

### 4. **Few-shot Examples** (–ü—Ä–∏–º–µ—Ä—ã)

–î–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã:

```python
# –î–ª—è —Ä—É—Å—Å–∫–æ–≥–æ
"""
–ü—Ä–∏–º–µ—Ä:
–í—Ö–æ–¥–Ω–æ–π —Ç–µ–∫—Å—Ç: "–ü—Ä–æ–µ–∫—Ç –Ω–∞—á–∞–ª—Å—è –≤ –º–∞—Ä—Ç–µ."
Summary: "–ü—Ä–æ–µ–∫—Ç —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª –≤ –º–∞—Ä—Ç–µ."

–¢–µ–ø–µ—Ä—å —Ç–≤–æ—è –æ—á–µ—Ä–µ–¥—å:
TEXT: {text}
SUMMARY:
"""
```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

| –ü–æ–¥—Ö–æ–¥ | –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|--------|---------------|-----------|-------------------|
| **Explicit instruction** | 80-90% | –ù–∏–∑–∫–∞—è | –í—Å–µ–≥–¥–∞ (–±–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å) |
| **Language detection + markers** | 90-95% | –°—Ä–µ–¥–Ω—è—è | ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è |
| **Few-shot examples** | 95-99% | –í—ã—Å–æ–∫–∞—è | –ö–æ–≥–¥–∞ –ø–µ—Ä–≤—ã–µ –¥–≤–∞ –Ω–µ –ø–æ–º–æ–≥–ª–∏ |
| **Separate prompts per language** | 99%+ | –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è | Production —Å–∏—Å—Ç–µ–º—ã |

---

## üîß –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞

```python
detected_lang = detect_language(text)
# 'ru' –µ—Å–ª–∏ > 30% –∫–∏—Ä–∏–ª–ª–∏—Ü—ã
# 'en' –µ—Å–ª–∏ –ª–∞—Ç–∏–Ω–∏—Ü–∞
# 'unknown' –µ—Å–ª–∏ –Ω–µ—è—Å–Ω–æ
```

### 2. –Ø–∑—ã–∫–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

**–î–ª—è —Ä—É—Å—Å–∫–æ–≥–æ:**
```
–í–ê–ñ–ù–û: –û—Ç–≤–µ—á–∞–π –Ω–∞ –†–£–°–°–ö–û–ú –Ø–ó–´–ö–ï. 
–í—Ö–æ–¥–Ω–æ–π —Ç–µ–∫—Å—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º - —Ç–≤–æ–π –æ—Ç–≤–µ—Ç —Ç–æ–∂–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º.
```

**–î–ª—è –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ:**
```
IMPORTANT: Respond in ENGLISH. 
The input text is in English - your response must also be in English.
```

### 3. –ú–∞—Ä–∫–µ—Ä—ã –≤ –ø—Ä–æ–º–ø—Ç–µ

```
TEXT (Language: –†—É—Å—Å–∫–∏–π):
{—Ä—É—Å—Å–∫–∏–π —Ç–µ–∫—Å—Ç}

SUMMARY (in –†—É—Å—Å–∫–∏–π):
```

### 4. –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

```
1. –í –Ω–∞—á–∞–ª–µ: "–í–ê–ñ–ù–û: –û—Ç–≤–µ—á–∞–π –Ω–∞ –†–£–°–°–ö–û–ú..."
2. –í —Å–µ—Ä–µ–¥–∏–Ω–µ: "Remember: USE THE SAME LANGUAGE..."
3. –í –∫–æ–Ω—Ü–µ: "SUMMARY (in –†—É—Å—Å–∫–∏–π):"
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

```bash
curl -X POST /summarize -d '{"doc_id":"russian_doc"}'

# Response:
"Project Alpha started on March 1, 2025..."  ‚ùå –ê–Ω–≥–ª–∏–π—Å–∫–∏–π!
```

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

```bash
curl -X POST /summarize -d '{"doc_id":"russian_doc"}'

# –õ–æ–≥–∏:
[Language Detection] Detected: ru (–†—É—Å—Å–∫–∏–π)
[Summarization] Language instruction added

# Response:
"–ü—Ä–æ–µ–∫—Ç Alpha –Ω–∞—á–∞–ª—Å—è 1 –º–∞—Ä—Ç–∞ 2025 –≥–æ–¥–∞..."  ‚úÖ –†—É—Å—Å–∫–∏–π!
```

---

## üìã –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥–µ–ª–∏ —Å —Å–∏–ª—å–Ω—ã–º multilingual

- **qwen2.5:7b**, **qwen3:14b** - –æ—Ç–ª–∏—á–Ω—ã–µ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ
- **aya-8b** - —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è multilingual
- **llama3.1** —Å explicit prompting (—Ç–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥)

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†–∞–∑–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–æ–≤

```python
PROMPTS = {
    'ru': "–ö—Ä–∞—Ç–∫–æ —Å—É–º–º–∞—Ä–∏–∑–∏—Ä—É–π —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç...",
    'en': "Summarize the following text concisely...",
}

prompt = PROMPTS[detected_lang].format(text=text)
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: System prompt —Å —è–∑—ã–∫–æ–º

–î–ª—è –º–æ–¥–µ–ª–µ–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏—Ö system messages:

```python
{
    "system": "You are a helpful assistant. Always respond in the same language as the user's input.",
    "user": "Summarize: {text}"
}
```

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ):**

1. ‚úÖ –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞
2. ‚úÖ –Ø–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ (3x repetition)
3. ‚úÖ –Ø–∑—ã–∫–æ–≤—ã–µ –º–∞—Ä–∫–µ—Ä—ã
4. ‚è≥ Few-shot (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

**–≠—Ç–æ –∑–æ–ª–æ—Ç–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è multilingual RAG —Å–∏—Å—Ç–µ–º!**

---

**–ì–æ—Ç–æ–≤ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä—É—Å—Å–∫–∏–º —Ç–µ–∫—Å—Ç–æ–º?** üöÄ

